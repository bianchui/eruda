<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>JsConsole</title>
</head>
<body>

<script src="eruda.js"></script>
<script src="node_modules/js-base64/base64.min.js"></script>

<script type="module">
eruda.init();
//const consoles = erudaWxConsole(eruda)  
//
//eruda.get().config.set({
//  displaySize: 100,
//  transparency: 1,
//  tinyNavBar: true,
//  navBarBgColor: '#00b26a'
//})
eruda.get().config.set({
  displaySize: 100,
  transparency: 1,
  tinyNavBar: true,
  navBarBgColor: '#006ab2'
});
//eruda.remove('settings');
eruda.show();

var con = eruda.get('console');

import { decode } from './src/decoder.js'
import { encode } from './src/encoder.js'

function parse(log) {
  try {
    log = Base64.decode(log);
    return JSON.parse(log);
  } catch (e) {
    window.console.warn(log);
    throw e;
  }
}

function addLog(log) {
  var obj = parse(log);
  if (obj.args) {
    obj.args = decode(obj.args);
  }
  con.insert(obj);
}

const log = {
  send: function(type, args, stack) {
    var enc = encode.apply(null, args);
    var res = {
      type: type,
      args: enc,
    };
    if (stack) {
      res.stack = stack;
    }
    var str = JSON.stringify(res);
    var buf = Base64.encode(str);
    addLog(buf);
  },
  debug: function () {
    this.send('debug', arguments);
  },
  info: function debug() {
    this.send('info', arguments);
  },
  log: function log() {
    this.send('log', arguments);
  },
  warn: function () {
    this.send('warn', arguments);
  },
  error: function () {
    this.send('error', arguments, (new Error("")).stack);
  },
};


</script>

</body>
</html>


